<%= form_with(model: activity, local: true, class: "space-y-6") do |form| %>
  <% if activity.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-red-800">
            <%= pluralize(activity.errors.count, "error") %> prohibited this activity from being saved:
          </h3>
          <div class="mt-2 text-sm text-red-700">
            <ul class="list-disc list-inside space-y-1">
              <% activity.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div>
    <%= form.label :name, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_field :name, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500", placeholder: "e.g., Pub Trivia at the Willows" %>
  </div>

  <div>
    <%= form.label :description, class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.text_area :description, rows: 4, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500", placeholder: "Describe the activity..." %>
  </div>

  <div>
    <%= form.label :schedule_type, "Schedule Type", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :schedule_type,
        options_for_select(schedule_type_options, activity.schedule_type),
        { prompt: 'Select schedule type...' },
        { class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500", id: "schedule_type_select" } %>
  </div>

  <!-- Strict Schedule Fields -->
  <div id="strict_fields" class="space-y-4" style="display: none;">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= form.label :start_time, "Start Date & Time", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.datetime_local_field :start_time, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" %>
      </div>
      <div>
        <%= form.label :end_time, "End Date & Time", class: "block text-sm font-medium text-gray-700 mb-2" %>
        <%= form.datetime_local_field :end_time, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" %>
      </div>
    </div>
  </div>

  <!-- Deadline Fields -->
  <div id="deadline_fields" style="display: none;">
    <div>
      <%= form.label :deadline, "Deadline", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.date_field :deadline, class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" %>
    </div>
  </div>

  <div>
    <%= form.label :max_frequency_days, "Repeat Frequency", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= form.select :max_frequency_days,
        options_for_select(max_frequency_options, activity.max_frequency_days),
        { prompt: 'How often would you like to repeat this?' },
        { class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" } %>
  </div>

  <div>
    <%= form.label :links, "Related Links (optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <div id="links_container">
      <% activity.activity_links.each_with_index do |link, index| %>
        <div class="flex mb-2">
          <input type="text" name="activity[links][]" value="<%= link %>" placeholder="https://example.com" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:ring-blue-500 focus:border-blue-500">
          <button type="button" onclick="removeLink(this)" class="px-3 py-2 bg-red-500 text-white rounded-r-lg hover:bg-red-600">Remove</button>
        </div>
      <% end %>
    </div>
    <button type="button" onclick="addLink()" class="mt-2 text-blue-600 hover:text-blue-800 text-sm font-medium">+ Add Link</button>
  </div>

  <div class="flex justify-end space-x-3 pt-4 border-t">
    <%= link_to "Cancel", activities_path, class: "px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition duration-200" %>
    <%= form.submit class: "px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition duration-200" %>
  </div>
<% end %>

<script>
  function toggleScheduleFields() {
    const scheduleType = document.getElementById('schedule_type_select').value;
    const strictFields = document.getElementById('strict_fields');
    const deadlineFields = document.getElementById('deadline_fields');

    // Hide all conditional fields
    strictFields.style.display = 'none';
    deadlineFields.style.display = 'none';

    // Show relevant fields
    if (scheduleType === 'strict') {
      strictFields.style.display = 'block';
    } else if (scheduleType === 'deadline') {
      deadlineFields.style.display = 'block';
    }
  }

  function addLink() {
    const container = document.getElementById('links_container');
    const div = document.createElement('div');
    div.className = 'flex mb-2';
    div.innerHTML = `
      <input type="text" name="activity[links][]" placeholder="https://example.com" class="flex-1 px-3 py-2 border border-gray-300 rounded-l-lg focus:ring-blue-500 focus:border-blue-500">
      <button type="button" onclick="removeLink(this)" class="px-3 py-2 bg-red-500 text-white rounded-r-lg hover:bg-red-600">Remove</button>
    `;
    container.appendChild(div);
  }

  function removeLink(button) {
    button.parentElement.remove();
  }

  // Initialize form
  document.addEventListener('DOMContentLoaded', function() {
    toggleScheduleFields();
    document.getElementById('schedule_type_select').addEventListener('change', toggleScheduleFields);
  });
</script>